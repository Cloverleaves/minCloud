<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>{{ title }}</title>
        <link rel="stylesheet" type="text/css" href="{{ static_url("css/style.css") }}">
        <script src="{{ static_url("js/jquery-1.11.2.min.js") }}"></script>
    </head>
    <body>
        <header>
            <div id="header">
                <h1><a href="/">minCloud</a></h1> 
                <p class="muted">v.0.0.1-alpha</p>
            </div>
        </header>

        <div class="action">
            <div class="label">cloudstore/<strong>{{ escape(currentdir) }}</strong></div>
            <form id="file-upload" action="/upload" method="post" enctype="multipart/form-data">
                <div class="upload-input">
                    <input type="hidden" name="path" value="{{ escape(currentdir) }}">
                    <input type="file" name="file" id="upload-input" class="upload-input" multiple>
                </div>
            </form>

            <form action="/mkdir" method="post">
                <label>Create directory</label>
                <input type="text" name="name">
            </form>
        </div>

        <!-- global -->
        <input type="hidden" id="currentdir" value="{{ escape(currentdir) }}">

        <div id="filemanager">
            {% if currentdir != "" %}
                <div class="dir-click" data-target="{{ escape(parentdir) }}">...</div>
            {% end %}

            {% for dir in dirs %}
                <div class="dir">
                    <img class="dir-click thumb" src="{{ static_url("assets/folder.png") }}" data-target="{{ escape(dir[1]) }}"> 
                    <input type="text" class="item-input" data-target="{{ dir[0] }}" value="{{ escape(dir[0]) }}" autocomplete="off">
                </div>
            {% end %}

            {% for file in files %}
                <div class="file">
                    <img class="thumb" src="{{ static_url("assets/file.png") }}">
                    <input type="text" class="item-input" data-target="{{ escape(file[0]) }}" value="{{ escape(file[0]) }}" autocomplete="off">
                </div>
            {% end %}

            {% if len(dirs) + len(files) == 0 %}
                <div>No files and directories to display!</div>
            {% end %}
        </div>

        <script type="text/javascript">
        // Rename
        $(".item-input").change(function(){
            data = {
                path: $("#currentdir").val(),
                target: $(this).data("target"),
                name: $(this).val()
            }
            $.ajax({
                type: "POST",
                url: "/rename",
                data: data,
                success: function(data) {
                    window.location.reload();
                }
            });
        });

        $(".dir-click").click(function(){
            window.location = "/?dir=" + $(this).data("target");
        });

        // Auto upload on file select
        $("#upload-input").change(function() {
            $("#file-upload").submit();
        });
        </script>
 
    </body>
</html>